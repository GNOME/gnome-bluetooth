image: fedora:rawhide

variables:
  DEPENDENCIES:
    gtk-doc
    gobject-introspection-devel
    gtk3-devel
    systemd-devel
    libcanberra-devel
    libnotify-devel
    meson
    redhat-rpm-config
    gcc
    glibc-devel
    git
  GIT_SUBMODULE_STRATEGY: recursive

build_stable:
  before_script:
    - dnf update -y --nogpgcheck
    - dnf install -y --nogpgcheck $DEPENDENCIES
    # Work-around ldd bug in rawhide CIs
    - sed -i -e 's/test -r/test -f/g' -e 's/test -x/test -f/g' /bin/ldd
  script:
    - meson . _build --prefix=/usr
    - ninja -C _build
    - ninja -C _build install
    - ninja -C _build test
    - ninja -C _build dist
